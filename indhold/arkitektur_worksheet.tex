\section{Arkitektur}\label{sec:arkitektur}
Dette afsnit præsenterer arkitekturen som er udarbejdet på baggrund af de specificerede behov i \cref{arkitekturkrav}.
Først beskrives den overordnede opbygning.
Derefter beskrives komponenterne mere detaljeret.

\paragraph{Platform}
Projektet har valgt at bruge Android platformen, se \cref{sec:valg_af_android}, som også lægger op til nogle overvejelser ift. arkitektur.

Arkitekturen er lavet ud fra ideen om at applikationer på Android kan kontakte hinanden igennem Android systemet.
Det er muligt for en hovedapplikation at starte en service der ligger i en anden applikation \cite{android_service}.
Dette udnyttes ved at pakke alle moduler i hver deres selvstændige applikation.
Ved at anvende en centraliseret database vil det være muligt for moduler at få adgang til data fra andre moduler.
Samtidig kan adgangsrettigheder til de forskellige tabeller styres et sted.
På den måde kan adgang kontrolleres på alle moduler, inklusiv de der måtte blive udviklet i fremtiden.
Hertil ønskes en central styrende enhed, der skal fungere som bindeled mellem de installerede moduler.

\subsection{Opbygning}\label{arkitektur:opbygning}
Den overordnede arkitektur er opbygget af fire komponenter: \textit{manager}, \textit{moduler}, \textit{DB\footnote{Database} access} og \textit{DB}.
For at opfylde de specificerede behov i \cref{arkitekturkrav}, nærmere nøgleordene \textit{modulær}(se \cref{arkitekturkrav::modulaer}) og \textit{fleksibel}(se \cref{arkitekturkrav::fleksibel}) er arkitekturen opbygget af moduler der opsamler data, analyser denne data og viser den uafhængige af hinanden.
Disse moduler kan vælges til eller fra i \textit{manager}'en.


Et diagram over arkitekturen kan ses på \cref{arkitektur_udkast_1}.
\begin{figure}[h]
	\centering						%  l   b   r	t
	\includegraphics[scale=0.5, trim = 1cm 17.5cm 1cm 1cm, clip]{ArkitekturLucidChart}
	\caption{Systemets arkitektur}
  \label{arkitektur_udkast_1}
\end{figure}

Herefter beskrives komponenterne i rækkefølge af deres indbyrdes afhængighed, således at forståelsen af hver komponent kun afhænger af det læste.

\subsection{DB}
Denne komponent administrerer data for systemets forskellige moduler.
Data opbevares i en række tabeller i et relationelt database system.
Hvert modul har mulighed for at definere egne tabeller, der alle gemmes i \textit{DB} komponenten.

Til dette projekt er valgt en SQLite database da denne er standard i Android \cite{android_database}.


\subsection{DBAccess}\label{subsec:DBACCESS}
Denne komponent styrer adgangen til \textit{DB} komponenten så det sker på en ensrettet måde.
Da vi arbejder på en mobil platform er det værd at tage højde for lagerstyring og abstraktion derover.
Da der er begrænset plads på en smartphone kan det blive relevant at lagre noget af det indsamlede data i skyen.
Grundet denne potentielle opdeling af lager placeringer, kan de være nyttigt at abstrahere over hvor data lagres.

For at opfylde nøglepunktet \textit{kommunikation}, se \cref{arkitekturkrav::kommunikation}, er det nødvendigt at sørge for at moduler har adgang til kun at skrive til deres egen database og samtidig læse fra alle andres database.
På denne måde forhindres det at eksterne moduler modificerer andre modulers data.

\paragraph{Design} 
For at imødekomme kravene om både at give ensrettet adgang til moduler og stille garantier om adgangsrettigheder er der blevet valgt at benytte facade designmønster \citep[s.~185]{gamma1994design}.

Grunden til at facade er benyttet er fordi det giver en kobling mellem moduler og databasen.
Denne kobling sker gennem et interface der sørger for modulerne kun skal opfylde nogle få krav for at få deres data gemt i databasen, samt for at få data fra andre moduler.
Endvidere, sørger den kobling for at skabe en specifik og sikker kommunikation mellem moduler sker nemt og sikkert, hvilket er nødvendigt for at opfylde nøglepunktet \textit{kommunikation}, se \cref{arkitekturkrav::kommunikation}.

\subsection{Moduler}
Denne komponent befinder sig i et lag for sig selv og indeholder tre typer moduler: \textit{data}, \textit{analyse} og \textit{visualisering}.
Komponenten indeholder applikationens hovedfunktionalitet og er ansvarlig for indsamling af data, bearbejdelse af data og visualisering af data.

Dette afsnit beskriver hvordan modulerne er defineret og en beskrivelse af de tre typer moduler.
Men først en begrundelse for valget af dette lag på baggrund af behovene i \cref{arkitekturkrav}.

\paragraph{Begrundelse for valg}
For at opfylde nøgleordet \textit{modulær}(se \cref{arkitekturkrav::modulaer}) er det valgt lave et lag der indeholder moduler, så det er let at tilføje og fjerne moduler.
Dette kunne fx være i en situation hvor der kommer nye sensorer på markedet, eller hvis der skal laves nye former for visualiseringer til det allerede indsamlede data.

\input{indhold/modul_definition}
\input{indhold/modul_view}

\subparagraph{Data}
\textit{Data}-laget indeholder moduler der indsamler data fra smartphonens (eller tilbehør dertil) forskellige sensorer og applikationer.
Der påføres kun et minimum af behandling på indsamlede data (eksempelvis komprimering) således at data kan indsamles kontinuert uden stort energi-behov.
Derudover for at have mulighed for at lave meningsfulde analyser skal alt logget data gemmes i \textit{DB} i rå eller komprimeret form.
Det vil sige at komprimering skal være tabsfri og at eventuelle fejlmålinger bør markeres som sådan i den pågældende data tabel.

Et eksempel på et sensormodul er indsamling af data fra accelerometret.
Modulet får data fra accelerometret og gemmer det i sin database. 
For ikke at gemme unødvendige mængder data vil modulet kun gemme et datapunkt når det er forskelligt fra det forrige målte punkt.

\subparagraph{Analyse}
\textit{Analyse}laget indeholder moduler der bruger data fra et antal sensormoduler samt eventuelle andre analysemoduler.
Herefter udføres en analyse af det indsamlede data med \textit{''forståelig information''} som resultat.
I denne process vil der kunne forekomme tab af data.
Herved opnås en opsummering af det indsamlede data, der skaber værdifuld information for brugeren.
Som en del af et analysemoduls beskrivelse findes en beskrivelse af hvilken information man kan få fra modulet.
Denne information anvendes af visualiseringsmodulerne.

Der kan ved analyse af sensordata anvendes flere ressourcer, da analysen typisk vil kunne udføres på større mængder indsamlede data få gange dagligt.
Eksempelvis kan analysen foretages om natten hvor smartphonen kan sættes til opladning.

Et eksempel på et analysemodul kan være et søvnanalyse modul der bruger førnævnte accelerometer data til at undersøge en sovendes søvn.
Dette modul vil bruge flere sensormoduler til sin analyse og vil muligvis bruge accelerometerdata fra både en smartphone og et smart watch.

\subparagraph{Visualisering}
\textit{Visualiserings}laget indeholder moduler der visualiserer analyserede data.
Som en del af et visualiseringsmoduls beskrivelse findes en beskrivelse af hvilken information modulet accepterer.
Hvis denne beskrivelse stemmer overens med et analysemodul, kan den enkelte visualisering anvendes på den enkelte analyse.

Et eksempel på et visualiseringsmodul er et modul der visualisere de resultater som føromtalte søvnanalyse har fundet frem til.
Dette kunne være en graf der fortæller hvor dyb søvn man har været i, eller en simpel farvet indikator hvis farve viser hvor godt man har sovet de sidste par dage.

Eksempelvis vil et accelerometer \textit{sensor}modul kunne anvendes af et søvn \textit{analyse}modul der viser resultatet i et graf \textit{visualiserings}modul.

Skulle man her ønske en anden fortolkning af accelerometerets data kan et andet analysemodul anvendes.
Sammensætningen af analyse- og visualiseringsmoduler sker ved en beskrivelse af deres grænseflade.
Moduler med fælles grænseflade vil kunne kombineres.
Det vil sige at der kan anvendes flere forskellige visualiseringsmoduler til det samme analysemodul, givet at de er kompatible.
Tilsvarende kan det samme visualiseringsmoduler anvendes til flere forskellige analysemoduler.

\subsection{Manager}\label{subsec:arkitektur-Manager}
Dette afsnit begrunder valget af denne komponent.
Derefter beskrives komponenten.

\paragraph{Begrundelse for valg}
For at opfylde nøgleordet \textit{fleksibel}(\cref{arkitekturkrav::fleksibel}), er der tilføjet en komponent kaldet manager.
Manager komponenten kan siges at være grænsefladen mellem bruger og moduler.
Den står for at administrere de installerede moduler ud fra de beskrivelser der er givet for de enkelte moduler.
Denne administration indebærer blandt andet oprettelse af de database tabeller hvert modul har bedt om i sin beskrivelse, samt start og stop af sensor- og analysemoduler.
Sidstnævnte sker ud fra definitioner givet i beskrivelserne af de enkelte moduler.
Desuden er det også gennem manageren brugeren får vist den information de leder efter.

\paragraph{Design}
Ved at sammenholde visualiseringer og analyser kan manageren beskrive for brugeren hvilke data der kan fremvises og med hvilke visualiseringer det kan ske.
Manageren har desuden en prædefineret brugerflade der anvender ovenstående kombinationer til at vise brugeren de relevante informationer.

Manager komponenten indeholder desuden et JSON skema for hver modul-type i moduler komponenten.
Disse definitioner beskriver formatet for eventuelle nye moduler man måtte ønske at føje til systemet.
\stefan{et eller flere skemaer? Muligvis har views anderledes skema, men analyse og sensorer har det samme}

